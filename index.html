<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bootstrap, from Twitter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <style type="text/css">
     	body {
        	padding-top: 60px;
        	padding-bottom: 40px;
      	}
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>

  	<div class="container" >

    	<div class="row">
    		<form action="/send/">

	    		<div id="log" style="height:200px; width:200px; overflow-y:scroll; background-color:black; color:#aaa;">
	    		</div>
	    		<input type="text" name="input" id="user-input" placeholder="input..." />
	    		<input type="submit" value="Send" />

    		</form>

    	</div>

    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/js/bootstrap.min.js"></script>
    <script>

    	var wsUri = "ws://localhost:3000/";
		var output;


		function connectWebSocket() {
			websocket = new WebSocket(wsUri);

			websocket.onopen = function(evt) { onOpen(evt) };

			websocket.onclose = function(evt) { onClose(evt) };

			websocket.onmessage = function(evt) { onMessage(evt) };

			websocket.onerror = function(evt) { onError(evt) };
		}

		function onOpen(evt) {
			writeToLog("CONNECTED");
		}

		function onClose(evt) {
			writeToLog("DISCONNECTED"); 
		}

		function onMessage(evt) {
			writeToLog('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>');
			 websocket.close();
		}  

		function onError(evt) {
			writeToLog('<span style="color: red;">ERROR:</span> ' + evt.data);
		}

		function doSend(message) {
			writeToLog("SENT: " + message);  websocket.send(message);
		}

		function writeToLog(message) {
			var pre = document.createElement("p");
			pre.style.wordWrap = "break-word";
			pre.innerHTML = message;
			output.appendChild(pre);
		}  

		$(function(){

			output = document.getElementById("log");
			connectWebSocket();

			$('form').submit(function(){
				var message = $('#user-input').val();


				if(message){
					doSend(message);
				}

				return false;
			});

		});

    </script>

  </body>
</html>
